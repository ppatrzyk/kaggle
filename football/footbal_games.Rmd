---
title: "Direct Games"
author: "Piotr Patrzyk"
output: 
  html_document:
    keep_md: false
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
library(data.table)
library(r2d3)

knitr::opts_chunk$set(echo = FALSE)
```

```{r dataload}
games <- fread('results.csv', encoding = 'UTF-8')
```

TODO intro Dataset is inconsistent about treatment of nonexistent countries: Soviet Union labeled as Russia, but German DR, Czechoslovakia, Yugoslavia left intact

```{r getresults}
games[, goal_diff := home_score - away_score]
unique_teams <- games[, unique(c(home_team, away_team))]
outcomes_list <- replicate(length(unique_teams), data.table())
for (i in 1:length(unique_teams)) {
  current_team <- unique_teams[i]
  current_games <- games[home_team == current_team | away_team == current_team, ]
  current_games[, location_home := (home_team == current_team)]
  current_games[, rival := ifelse(location_home, away_team, home_team)]
  current_games[location_home == FALSE, goal_diff := -goal_diff]
  outcomes <- current_games[,
    .(
      win = sum(goal_diff > 0),
      draw = sum(goal_diff == 0),
      loss = sum(goal_diff < 0),
      total = .N
    ),
    by = rival
  ]
  outcomes[, winloss_ratio := win/loss]
  outcomes_list[[i]] <- outcomes
  # TODO outcomes is a dt for single country (current_team)
  # return suitable json r2d3 or rjson tojson
}

outcomes <- rbindlist(outcomes_list)

bars <- c(10, 20, 40)
```

Actual d3 viz:

```{d3 map, data=bars}
# test code copypasted from r2d3 website
svg.selectAll('rect')
  .data(data)
  .enter()
    .append('rect')
      .attr('width', function(d) { return d * 10; })
      .attr('height', '20px')
      .attr('y', function(d, i) { return i * 22; })
      .attr('fill', 'blue');
```

